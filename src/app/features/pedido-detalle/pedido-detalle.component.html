<div class="max-w-4xl mx-auto p-4 sm:p-6 lg:p-8">
    <div *ngIf="isLoading" class="text-center p-8">
        <mat-spinner diameter="50" class="mx-auto"></mat-spinner>
        <p class="mt-4 text-slate-500">Cargando detalles del pedido...</p>
    </div>

    <div *ngIf="!isLoading && pedido">
        <div class="flex flex-col sm:flex-row justify-between items-start mb-6 gap-4">
            <div>
                <h1 class="text-3xl font-bold text-slate-800">Detalle del Pedido #{{ pedido.id }}</h1>
                <p class="text-slate-500">Realizado el {{ pedido.fecha | date:'fullDate' }} a las {{ pedido.fecha | date:'shortTime' }}</p>
            </div>
            <button mat-stroked-button routerLink="/pedidos">
                <mat-icon>arrow_back</mat-icon>
                Volver a la Lista
            </button>
        </div>

        <!-- Información del Cliente y Pedido -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            <mat-card>
                <mat-card-header>
                    <mat-card-title>Información del Cliente</mat-card-title>
                </mat-card-header>
                <mat-card-content class="space-y-2">
                    <p><strong>Nombre:</strong> {{ pedido.clienteNombre }}</p>
                    <p><strong>NIT:</strong> {{ pedido.clienteNit }}</p>
                    <p><strong>Dirección:</strong> {{ pedido.direccionEntrega }}</p>
                    <p><strong>Ciudad:</strong> {{ pedido.ciudadEntrega }}</p>
                </mat-card-content>
            </mat-card>
            <mat-card>
                <mat-card-header>
                    <mat-card-title>Datos del Pedido</mat-card-title>
                </mat-card-header>
                <mat-card-content class="space-y-2">
                    <p><strong>Asesor:</strong> {{ pedido.asesor }}</p>
                    <p><strong>Estado:</strong>
                        <span class="font-semibold px-2 py-1 text-sm rounded-full" [ngClass]="{
                            'bg-yellow-100 text-yellow-800': pedido.estado === 'PENDIENTE',
                            'bg-blue-100 text-blue-800': pedido.estado === 'ENVIADO',
                            'bg-green-100 text-green-800': pedido.estado === 'ENTREGADO',
                            'bg-red-100 text-red-800': pedido.estado === 'CANCELADO'
                        }">{{ pedido.estado }}</span>
                    </p>
                </mat-card-content>
            </mat-card>
        </div>

        <!-- Lista de Productos -->
        <mat-card>
            <mat-card-header>
                <mat-card-title>Artículos del Pedido</mat-card-title>
            </mat-card-header>
            <mat-card-content>
                <mat-list>
                    <div *ngFor="let item of pedido.items">
                        <mat-list-item class="h-auto py-2">
                            <!-- ¡IMAGEN AÑADIDA! -->
                            <img matListItemAvatar [src]="item.imagenUrl ? 'assets/' + item.imagenUrl : 'assets/nombre.jpeg'" alt="{{ item.productoNombre }}" class="object-contain border rounded-md">
                            
                            <div matListItemTitle class="font-semibold">{{ item.productoNombre }}</div>
                            <div matListItemLine>Código: {{ item.productoCodigo }}</div>
                            
                            <div matListItemMeta class="flex items-center gap-6 text-sm">
                                <span>Cant: {{ item.cantidad }}</span>
                                <span class="w-28 text-right">{{ item.subtotal | currency:'COP':'symbol-narrow':'1.0-0' }}</span>
                            </div>
                        </mat-list-item>
                        <mat-divider></mat-divider>
                    </div>
                </mat-list>
                <div class="text-right font-bold text-2xl mt-4 p-4 bg-slate-50 rounded-lg">
                    Total del Pedido: {{ pedido.total | currency:'COP':'symbol-narrow':'1.0-0' }}
                </div>
            </mat-card-content>
        </mat-card>

        <!-- Acciones -->
        <div class="mt-8 flex flex-wrap justify-end gap-4">
            <button mat-stroked-button (click)="exportarPDFCliente()">
                <mat-icon>picture_as_pdf</mat-icon>
                PDF Cliente
            </button>
            <button mat-stroked-button (click)="exportarPDFBodega()">
                <mat-icon>inventory</mat-icon>
                PDF Bodega
            </button>
            <button mat-flat-button color="primary" (click)="editarPedido()" [disabled]="pedido.estado !== 'PENDIENTE'">
                <mat-icon>edit</mat-icon>
                Editar Pedido
            </button>
        </div>
    </div>
</div>